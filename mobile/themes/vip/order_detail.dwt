<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>{$page_title}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<link href="{$ectouch_themes}/images/touch-icon.png" rel="apple-touch-icon-precomposed" />
<link href="{$ectouch_themes}/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="{$ectouch_themes}/css/public.css?v=1.2"/>
<link href="{$ectouch_themes}/ectouch.css?v=1.1" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="{$ectouch_themes}/css/zlb.css"/>
<script type="text/javascript" src="{$ectouch_themes}/js/jquery.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
{insert_scripts files='common.js'}
{$stats_code}
<style>
.price{
	font-size: 14px;
}
</style>
</head>
<body>
<div id="page">
<div id="tbh5v0">
  <div class="login"> 
    
	<!-- ==========订单详情页面,包括：订单状态，商品列表，费用总计，收货人信息，支付方式，其它信息========== --> 
    <header id="header">
      <div class="header_l header_return"> <a class="ico_10" href="javascript:history.go(-1)"> 返回 </a> </div>
      <h1> {$lang.order_status} </h1>
    </header>
    <section class="wrap">
      <section class="order_box padd1 radius10">
        <table width="100%" border="0" cellpadding="5" cellspacing="0" class="ectouch_table">
      	<tr>
        	<td>订单状态：<strong>{$order.order_status} {$order.pay_status} {$order.shipping_time}</strong></td>
        </tr>
        <tr>
        	<td>订单编号：{$order.order_sn}</td>
        </tr>
        <tr>
        	<td>订单金额：<span class="price">{$order.formated_total_fee}</span></td>
        </tr>
        <tr>
        	<td>下单时间：{$order.formated_add_time}</td>
        </tr>
        <!--{if $order.to_buyer}-->
        <tr>
          <td>{$lang.detail_to_buyer}：{$order.to_buyer}</td>
        </tr>
        <!-- {/if} -->
        <!--{if $virtual_card}-->
        <tr>
          <td>{$lang.virtual_card_info}：<br>
          	<!--{foreach from=$virtual_card item=vgoods}--> 
            <!--{foreach from=$vgoods.info item=card}--> 
            <hr style="border:none;border-top:1px #CCCCCC dashed; margin:5px 0" />
            <!--{if $card.card_sn}-->{$lang.card_sn}:<span style="color:red;">{$card.card_sn}</span><br><!--{/if}-->
            <!--{if $card.card_password}-->{$lang.card_password}:<span style="color:red;">{$card.card_password}</span><br><!--{/if}--> 
            <!--{if $card.end_date}-->{$lang.end_date}:{$card.end_date}<br><!--{/if}-->
            <!--{/foreach}--> 
            <!--{/foreach}--></td>
        </tr>
        <!--{/if}-->
      </table>
      </section>
      
      <section class="order_box padd1 radius10">
      <table width="100%" border="0" cellpadding="5" cellspacing="0" class="ectouch_table">
        <tr>
          <td>{$lang.consignee_name}：<strong>{$order.consignee}</strong></td>
          
        </tr>
        <tr style="display: none;">
          <td>{$lang.email_address}：{$order.email}</td>
        </tr>
        <!-- {if $order.exist_real_goods} -->
        <tr>
          <td >{$lang.detailed_address}：{$order.address} </td>
          <!-- {if $order.zipcode} --> 
          <td >
            [{$lang.postalcode}: {$order.zipcode}] </td>
            <!-- {/if} -->
            
        </tr>
        <!-- {/if}-->
        <tr>
          <td >{$lang.phone}：{$order.mobile}</td>
        </tr>
        <!-- {if $order.exist_real_goods} -->
        <tr style="display: none;">
          <td >{$lang.deliver_goods_time}：{$order.best_time}</td>
        </tr>
        <!--{/if}-->
      </table>
      </section>
      
      <section class="order_box padd1 radius10">
        <table width="100%" border="0" cellpadding="5" cellspacing="0" class="ectouch_table">
      	  <!-- {foreach from=$goods_list item=goods} -->
          <tr>
            <td rowspan="2" width="60" align="center" valign="middle" style="border-bottom:1px #CCCCCC dashed">
            <a href="goods.php?id={$goods.goods_id}" target="_blank"><img src="{$site_url}{$goods.goods_thumb}" width="60" height="60" /></a></td>
            <td><strong>{$goods.goods_name}</strong>
            {if $goods.goods_attr}<br/>{$goods.goods_attr}{/if}
            </td>
          </tr>
          <tr>
            <td style="border-bottom:1px #CCCCCC dashed">售价：<span class="price">{$goods.goods_price}</span> 数量：<strong>{$goods.goods_number}</strong><br>小计：<span class="price">{$goods.subtotal}</span></td>
          </tr>
          <!-- {/foreach} -->
      </table>
      <table width="100%" border="0" cellpadding="5" cellspacing="0" class="ectouch_table">
        <tr>
          <td align="right"> {$lang.goods_all_price}<!-- {if $order.extension_code eq "group_buy"} -->{$lang.gb_deposit}<!-- {/if} -->: <span class="price">{$order.formated_goods_amount}</span> 
            <!-- {if $order.discount gt 0} 折扣 --> 
            - {$lang.discount}: {$order.formated_discount} 
            <!-- {/if} --> 
            <!-- {if $order.tax gt 0} --> 
            + {$lang.tax}: {$order.formated_tax} 
            <!-- {/if} --> 
            <!-- {if $order.shipping_fee > 0} --> 
            + {$lang.shipping_fee}: {$order.formated_shipping_fee} 
            <!-- {/if} --> 
            <!-- {if $order.insure_fee > 0} --> 
            + {$lang.insure_fee}: {$order.formated_insure_fee} 
            <!-- {/if} --> 
            <!-- {if $order.pay_fee > 0} --> 
            + {$lang.pay_fee}: {$order.formated_pay_fee} 
            <!-- {/if} --> 
            <!-- {if $order.pack_fee > 0} --> 
            + {$lang.pack_fee}: {$order.formated_pack_fee} 
            <!-- {/if} --> 
            <!-- {if $order.card_fee > 0} --> 
            + {$lang.card_fee}: {$order.formated_card_fee} 
            <!-- {/if} --></td>
        </tr>
        <!-- {if $order.money_paid > 0} -->
        <tr>
          <td align="right"><!-- {if $order.money_paid > 0} --> 
            {if $order.order_amount neq '0.00'}-{/if} {$lang.order_money_paid}: <span class="price">{$order.formated_money_paid}</span> 
            <!-- {/if} --> 
            <!-- {if $order.surplus > 0} --> 
            - {$lang.use_surplus}: {$order.formated_surplus} 
            <!-- {/if} --> 
            <!-- {if $order.integral_money > 0} --> 
            - {$lang.use_integral}: {$order.formated_integral_money} 
            <!-- {/if} --> 
            <!-- {if $order.bonus > 0} --> 
            - {$lang.use_bonus}: {$order.formated_bonus} 
            <!-- {/if} --></td>
        </tr>
        {/if}
        <!-- {if $order.order_amount > 0} -->
        <tr>
          <td align="right">
          	{$lang.order_amount}: <span class="price">{$order.formated_order_amount}</span>
            <!-- {if $order.extension_code eq "group_buy"} -->
            <br />
            {$lang.notice_gb_order_amount}
            <!-- {/if} -->
            </td>
        </tr>
        <!-- {/if} -->
        <!-- {if $allow_edit_surplus} 如果可以编辑使用余额数 -->
        <tr>
          <td align="right" bgcolor="#ffffff"><form action="user.php" method="post" name="formFee" id="formFee">
              {$lang.use_more_surplus}：
              <input name="surplus" type="text" size="8" value="0" style="border:1px solid #ccc; padding:3px; border-radius:5px;"/><br>
              {$max_surplus}
              <input type="submit" name="Submit" class="c-btn3" value="{$lang.button_submit}余额付款" />
              <input type="hidden" name="act" value="act_edit_surplus" />
              <input type="hidden" name="order_id" value="{$smarty.get.order_id}" />
            </form></td>
        </tr>
        <!--{/if}-->
      </table>
      </section>
      
      <section class="order_box padd1 radius10" style="display:none;">
      <table width="100%" border="0" cellpadding="5" cellspacing="0" class="ectouch_table">
        <tr>
          <td bgcolor="#ffffff"> {$lang.select_payment}: {$order.pay_name}。<br>{$lang.order_amount}: <strong>{$order.formated_order_amount}</strong><br />
           </td>
        </tr>
        <tr>
          <td bgcolor="#ffffff" align="center">
          <!--{if $payment_list}-->
            
            <form name="payment" method="post" action="user.php">
              {$lang.change_payment}: <br/>
              <select name="pay_id" style="margin:6px 0">
                <!--{foreach from=$payment_list item=payment}-->
                <option value="{$payment.pay_id}"> {$payment.pay_name}({$lang.pay_fee}:{$payment.format_pay_fee}) </option>
                <!--{/foreach}-->
              </select>
              <br/>
              <input type="hidden" name="act" value="act_edit_payment" />
              <input type="hidden" name="order_id" value="{$order.order_id}" />
              <input type="submit" name="Submit" class="c-btn3" value="{$lang.button_submit}" />
            </form>
            
            <!--{/if}--></td>
        </tr>
      </table>
      </section>
      
      <section class="order_box padd1 radius10" style="display:none;">
      <table width="100%" border="0" cellpadding="5" cellspacing="0" class="ectouch_table">
        <!-- {if $order.shipping_id > 0} -->
        <tr>
          <td colspan="3">{$lang.shipping}：{$order.shipping_name}</td>
        </tr>
        <!-- {/if} -->
        
        <tr>
          <td colspan="3">{$lang.payment}：{$order.pay_name}</td>
        </tr>
        <!--{if $order.insure_fee > 0}--> 
        <!--{/if}--> 
        <!-- {if $order.pack_name} 是否使用包装 -->
        <tr>
          <td colspan="3">{$lang.use_pack}：{$order.pack_name}</td>
        </tr>
        <!-- {/if} 是否使用包装 --> 
        <!-- {if $order.card_name} 是否使用贺卡 -->
        <tr>
          <td colspan="3">{$lang.use_card}：{$order.card_name}</td>
        </tr>
        <!-- {/if} --> 
        <!-- {if $order.card_message} 是否使用贺卡 -->
        <tr>
          <td colspan="3">{$lang.bless_note}：{$order.card_message}</td>
        </tr>
        <!-- {/if} 是否使用贺卡 --> 
        <!-- {if $order.surplus > 0} 是否使用余额 --> 
        <!-- {/if} --> 
        <!-- {if $order.integral > 0} 是否使用积分 -->
        <tr>
          <td colspan="2">{$lang.use_integral}：{$order.integral}</td>
        </tr>
        <!-- {/if} 是否使用积分 --> 
        <!-- {if $order.bonus > 0} 是否使用红包 --> 
        <!-- {/if} --> 
        <!-- {if $order.inv_payee && $order.inv_content} 是否开发票 -->
        <tr>
          <td >{$lang.invoice_title}：{$order.inv_payee}</td>
          <td ></td>
          <td >{$lang.invoice_content}：{$order.inv_content}</td>
        </tr>
        <!-- {/if} --> 
        <!-- {if $order.postscript} 是否有订单附言 -->
        <tr>
          <td colspan="2">{$lang.order_postscript}：{$order.postscript}</td>
        </tr>
        <!-- {/if} -->
        <tr>
          <td colspan="2">{$lang.booking_process}：{$order.how_oos_name}</td>
        </tr>
      </table>
      </section>
      
      {if $order.pay_status == '已付款'}
      <section class="order_box padd1 radius10">
	    <form id="shipping_form" action="suppliers.php" onsubmit="return send_goods()" method="POST">
	    <div class="form_title">物流发货</div>
	    <div class="camera"><a href="javascript:selectImage()"><img src="images/upload_img.png"/></a></div>
	    <div class="entry-list clearfix">
	    	<ul id="upload_img_ul">
	    		{foreach from=$order_shipping_img item=image name=image}
	    		<li style="position:relative;" id="shipping_img_{$smarty.foreach.image.index}">
	    			<img src="{$image.img_path}" />
	    			<input type="hidden" name="shipping_imgs[]" value="{$image.img_path}"/>
	    			<a class="ico_08 cha" href="javascript:remove_img('shipping_img_{$smarty.foreach.image.index}')" style="right: 5px;"> </a>
	    		</li>
	    		{/foreach}
	    	</ul>
	    </div>
	    <div style="margin-top: 10px;">
	    	<div class="form_label">快递/物流公司：<input type="text" id="shipping_name" name="shipping_name" value="{$order.shipping_name}"></input></div>
	    </div>
	    <div style="margin-top: 10px;">
	    	<div class="form_label">快递/物流单号：<input type="text" id="invoice_no" name="invoice_no" value="{$order.invoice_no}"></input></div>
	    </div>
	    <input type="hidden" name="order_id" value="{$order.order_id}"/>
	    <input type="hidden" name="act" value="deliver_goods"/>
	    <div style="margin-top: 10px;text-align: center;"><button class="send_btn" type="submit">一键发货</button></div>
	    </form>
	  </section>
	  {/if}
      
    </section>
    
    <!--#订单详情页 end--> 	
	<br/><br/>
</div>
</div>
 </div>
  <!-- #BeginLibraryItem "/library/footer_nav_suppliers.lbi" --><!-- #EndLibraryItem -->
</body>
<script type="text/javascript">
	wx.config({
	    debug: false,
	    appId: '{$signPackage.appId}',
	    timestamp: {$signPackage.timestamp},
	    nonceStr: '{$signPackage.nonceStr}',
	    signature: '{$signPackage.signature}',
	    jsApiList: [
	        'checkJsApi',
	        'chooseImage',
	        'uploadImage'
	    ]
	});
	
	function selectImage(){
		wx.chooseImage({
            success: function (res) {
                $.each( res.localIds, function(i, n){
                	wx.uploadImage({
                        localId: n,
                        success: function (res) {
                            var serverId = res.serverId;
                            $.get('suppliers.php?act=download_image_wx&serverId=' + serverId, function (result){
                            	if(result.errcode == 1){
                            		alert(result.errmsg);
                            	}else{
                            		$("#upload_img_ul").append('<li style="position:relative;" id="' + serverId + '"><img src="'+result.data+'" /><input type="hidden" name="shipping_imgs[]" value="'+result.data+'"/><a class="ico_08 cha" href="javascript:remove_img(\'' + serverId + '\')" style="right: 5px;"> </a></li>');
                            	}
                            }, 'json');
                            
                        },
                        fail: function (res) {
                            alert(JSON.stringify(res));
                        }
                    });
                    
                });
            }
        });
	}

	function send_goods(order_id){
		var shipping_name = $('#shipping_name').val();
		var invoice_no = $('#invoice_no').val();
		if(shipping_name == ''){
			openAlertDiv('请输入快递/物流公司!');
			return false;
		}
		if(invoice_no == ''){
			openAlertDiv('请输入快递/物流单号!');
			return false;
		}
		openConfirmDiv('确定要设为已发货吗？',"document.forms['shipping_form'].submit()");
		return false;
	}
	
	function remove_img(li_id){
		$("#" + li_id).remove();
	}
</script>
</html>
