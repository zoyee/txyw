
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>{$page_title}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<meta name="format-detection" content="telephone=no" />
<link href="{$ectouch_themes}/images/touch-icon.png" rel="apple-touch-icon-precomposed" />
<link href="{$ectouch_themes}/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="{$ectouch_themes}/css/public.css?v=1.2"/>
<link href="{$ectouch_themes}/ectouch.css?v=6.3" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="js/mtoch/css/swiper-3.3.1.min.css"/>
<script type="text/javascript" src="{$ectouch_themes}/js/jquery.min.js"></script>
<script type="text/javascript" src="{$ectouch_themes}/js/ectouch.js"></script>
{insert_scripts files='jquery.json.js,transport_index.js'}
{insert_scripts files='common.js'}
{$stats_code}

<style type="text/css">
.float-top{
	position:fixed;
	top:0px;
	z-index: 999;
	display: flex;
}
.swiper-container2{
	border-bottom: 1px solid #e3e3e3;
	background: white;
	width: 100%;
}
.swiper-container2 .swiper-slide {
    color: #858585;
    font-size: 13px !important;
    line-height: 40px !important;
    text-align: center;
    width: 160px;
    height: 40px;
    cursor: pointer;
}
.swiper-container2 .active-nav {
	color: #333333 !important;
    border-bottom: 2px solid #e31436 !important;
}
.ellipsis-nowrap{
	overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    word-break: keep-all;
}
</style>
</head>
<body>
<div id="page" style="right: 0px; left: 0px; display: block;">
  <header id="header" >
    <div class="header_l"> <a class="ico_10" href="cat_all.php"> 返回 </a> </div>
    <div id="search_box2" >
      <div class="search_box" >
        <form method="post" action="search.php" name="searchForm" id="searchForm_id">
          <input placeholder="请输入商品名称" name="keywords" type="text" id="keywordBox" />
          <button class="ico_07" type="submit" onclick="return check('keywordBox')"> </button>
        </form>
      </div>
    </div>
    <div class="header_r header_search"> <a class="switchBtn switchBtn-album" href="javascript:void(0);"  onclick="changeCl(this)" style="opacity: 1;"> 切换 </a> </div>
    
  </header>
{if count($categories) > 1}  
<div class="swiper-container2 swiper-container-horizontal">
  <!-- 子分类 -->
  <div class="swiper-wrapper">
  	<!--{foreach from=$categories item=cat}--> 
  		<div class="swiper-slide {if $cat.id eq $category}active-nav{/if}" {if $cat.id neq $category}onclick="query_cat('{$cat.id}');"{/if}>{$cat.name}</div>
   <!--{/foreach}-->
  </div>
</div>
{else}
<div class="tab_nav">
  <div class="header">
    <div class="h-left"><a title="返回" href="javascript:history.back()" class="sb-back"></a></div>
    <div class="h-mid">
      {$category_info.cat_name}
    </div>
    <div class="h-right">
      
    </div>
  </div>
</div>
{/if}
<div class="swiper-container3 swiper-container-horizontal">  
  <!--{if $catimgurl}-->
	<div style="z-index:1"><img width="100%" style="margin-top:10px;" src="{$catimgurl}"/></div>
  <!-- {/if} -->
  <div class="swiper-wrapper">
  	<div class="swiper-slide"> 
  <!-- #BeginLibraryItem "/library/goods_list_search.lbi" --><!-- #EndLibraryItem -->
  	</div>
  </div>
</div> 

  <!-- #BeginLibraryItem "/library/pages1.lbi" --><!-- #EndLibraryItem -->
  <div id='loder' class="more_loader_spinner" style="display: none;">
	<div style="text-align:center; margin:10px;">
	<img src="{$ectouch_themes}/images/loader.gif">
	</div>
  </div>

</div>

<!--筛选 S--->
<div id="nav" class="nav" style="right:-275px;">
  <form class="hold-height" action="category.php">
    <div class="attrExtra">
      <input type="hidden" name="category" value="{$category}"/>
      <button class="attrExtra-submit" type="submit">确定</button>
      <button class="attrExtra-cancel" type="button"  onclick="mtShowMenu()">取消</button>
    </div>
    <div class="attrs attr-fix" style="overflow: auto;height: 100%"> 
      <!--组合搜索 开始--> 
      <!--{if $brands.1 || $price_grade.1 || $filter_attr_list}--> 
      
      <!--{if $brands.1}-->
      <div class="attr brandAttr">
        <div class="attrKey">{$lang.brand}</div>
        <div class="attrValues">
          <ul class="av-collapse filter_list">
            <!--{foreach from=$brands item=brand}--> 
            <!-- {if $brand.selected} -->
            <li class="av-selected"> 
              <!-- {else} -->
            <li> 
              <!-- {/if} --> 
              <a href="javascript:void(0);" data="{$brand.brand_id}">{$brand.brand_name}</a></li>
            <!--{/foreach}-->
            <input type="hidden" name="brand" value="{$brand_id}" />
          </ul>
          <div class="av-options"><a class="j_More avo-more avo-more-down" href="javascript:;">查看更多<i></i></a> </div>
        </div>
      </div>
      <!--{/if}--> 
      
      <!--{if $price_grade.1}-->
      <div class="attr brandAttr">
        <div class="attrKey">{$lang.price}</div>
        <div class="attrValues">
          <ul class="av-collapse filter_list">
            <!--{foreach from=$price_grade item=grade}--> 
            <!-- {if $grade.selected} -->
            <li class="av-selected"> 
              <!-- {else} -->
            <li> 
              <!-- {/if} --> 
              <a href="javascript:void(0);" data="{$grade.start}|{$grade.end}">{$grade.price_range}</a></li>
            <!--{/foreach}-->
            <input type="hidden" name="price_min" value="{$price_min}" />
            <input type="hidden" name="price_max" value="{$price_max}" />
          </ul>
          <div class="av-options"><a class="j_More avo-more avo-more-down" href="javascript:;">查看更多<i></i></a> </div>
        </div>
      </div>
      <!--{/if}--> 
      
      <!--{foreach from=$filter_attr_list item=filter_attr}-->
      <div class="attr brandAttr">
        <div class="attrKey">{$filter_attr.filter_attr_name|escape:html}</div>
        <div class="attrValues">
          <ul class="av-collapse filter_list">
            <!--{foreach from=$filter_attr.attr_list item=attr}--> 
            <!-- {if $attr.selected} -->
            <li class="av-selected filter_attr"> 
              <!-- {else} -->
            <li class="filter_attr"> 
              <!-- {/if} --> 
              <a href="javascript:void(0);" data="{$attr.attr_id}">{$attr.attr_value}</a></li>
            <!--{/foreach}-->
          </ul>
          <div class="av-options"><a class="j_More avo-more avo-more-down" href="javascript:void(0);">查看更多<i></i></a> </div>
        </div>
      </div>
      <!--{/foreach}-->
      <input type="hidden" name="filter_attr" value="{$filter_attr}"/>
      <!-- {/if} --> 
      <!--组合搜索 结束--> 
    </div>
  </form>
</div>

<script type="text/javascript">
/* jQuery(function($){
	$('#J_ItemList').more({'address': 'category.php?act=asynclist&category={$category}&brand={$brand_id}&price_min={$price_min}&price_max={$price_max}&filter_attr={$filter_attr}&page={$pager.page}&sort={$pager.sort}&order={$pager.order}', 'spinner_code':'<div style="text-align:center; margin:10px;"><img src="{$ectouch_themes}/images/loader.gif" /></div>'})
	$(window).scroll(function () {
		if ($(window).scrollTop() == $(document).height() - $(window).height()) {
			$('.get_more').click();
		}
	});
}); */


</script>

<script type="text/javascript">
var page = 1;
/* $(document).ready(function() {
    $(window).scroll(function() {
        if ($(document).scrollTop() >= $(document).height() - $(window).height()) {
        	page++;
        	document.getElementById('loder').style.display = "";
        	region({$category},page)
        }
    });
}); */

function region(id,page){
	$.ajax({
		url:"categorylist.php?id="+id+"&page="+page,
		type:'GET',
		data:null,
		dataType:'json',
		success:function(json){
			//alert(json);
		document.getElementById("J_ItemList").innerHTML +=json['html'];
		document.getElementById('loder').style.display = "none";
		},
		error:function(json){
			//alert(json);
			document.getElementById('loder').style.display = "none";
		}
	}); 
}


</script>


<script type="text/javascript" src="{$ectouch_themes}/js/jquery.more.js"></script>
<script type="text/javascript" src="js/mtoch/js/swiper-3.3.1.min.js"></script>
<!-- #BeginLibraryItem "/library/footer_nav.lbi" --><!-- #EndLibraryItem -->
<script type="text/javascript">
var mySwiper2;
var mySwiper3;
 jQuery(function(){
	 
	 mySwiper2 = new Swiper('.swiper-container2',{
		 direction : "horizontal",
		 watchSlidesProgress : true,
		 watchSlidesVisibility : true,
		 slidesPerView : 4.5,
		 onInit: function(swiper){
			 {foreach from=$categories item=cat name=vo}
			 {if $cat.id eq $category}swiper.slideTo({$smarty.foreach.vo.index});{/if}
			 {/foreach}
		 },
		 onTap: function(){
			 /*  mySwiper3.slideTo( mySwiper2.clickedIndex) */
		 }
	 });
	 
	 /* mySwiper3 = new Swiper('.swiper-container3',{
		 setWrapperSize : true,
		 autoHeight: true,
		 direction : "horizontal",
		 slidesOffsetAfter : 100,
		 observer:true,
		 observeParents:true,
		 onSlideChangeStart: function(){
	 		updateNavPosition()
	 	 }
	 }); */
	 
	 $(window).scroll(function(){
	    var mytop = $(window).scrollTop();
	    if( mytop > $(".swiper-container2").offset().top){
	    	if(!$(".swiper-container2").hasClass("float-top")){
	        	$(".swiper-container2").addClass("float-top")
	    	}
	    }else if(mytop == 0){
	    	$(".swiper-container2").removeClass("float-top")
	    }

	});
	var more_status = 0; 
	$('.srp').more({'address': "{$pager.page_param}ajax_more=1", amount: 6, 'spinner_code':'<div style="text-align:center; margin:10px;"><img src="{$ectouch_themes}/images/loader.gif" /></div>'});
		$(window).scroll(function () {
			if (more_status == 0 && $(window).scrollTop() == $(document).height() - $(window).height()) {
				$('.get_more').click();
				more_status = 1;
				setTimeout(function(){
					more_status = 0;
				}, '1000');
			}
	});
 });
 
function updateNavPosition(){
	$('.swiper-container2 .active-nav').removeClass('active-nav')
	var activeNav = $('.swiper-container2 .swiper-slide').eq(mySwiper3.activeIndex).addClass('active-nav');
	if (!activeNav.hasClass('swiper-slide-visible')) {
		console.log(1);
		if (activeNav.index()>mySwiper2.activeIndex) {
			console.log(2);
			var thumbsPerNav = Math.floor(mySwiper2.width/activeNav.width())-1
			mySwiper2.slideTo(activeNav.index()-thumbsPerNav)
		}
		else {
			console.log(3);
			mySwiper2.slideTo(activeNav.index())
		}	
	}
}

function query_cat(cat_id){
	location.href="category.php?id=" + cat_id;
}
</script>
</body>
</html>
