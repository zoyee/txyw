<!DOCTYPE html>
<html>

{include file='head.htm'}

<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
        	{foreach from=$available_templates item=template}
            <div class="col-sm-4">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>{$template.name}</h5>
                    </div>
                    <div class="ibox-content">
                        <form class="form-horizontal m-t" id="signupForm" action="" method="post">
                            <div class="form-group">
                            	<div class="col-sm-12">
                                {if $template.screenshot}
                                <img src="{$template.screenshot}" border="0" style="width:100%;border:1px solid gray;" id="{$template.code}" onclick="javascript:setupTemplate('{$template.code}')"/>
                                {/if}
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">版本：</label>
                                <div class="col-sm-8">
                                    <p class="form-control-static">V{$template.version}</p>
                                    
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">作者：</label>
                                <div class="col-sm-8">
                                    <p class="form-control-static">{$template.author}</p>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">版本描述：</label>
                                <div class="col-sm-8">
                                    <p class="form-control-static">{$template.desc}</p>
                                </div>
                            </div>
                            {if $curr_template.code == $template.code}
                            <div class="form-group">
                             	<label class="col-sm-4 control-label"></label>
                             	<div class="col-sm-8">
									<p class="form-control-static">
										<input class="btn btn-primary"
											onclick="backupTemplate('{$template.code}')"
											value="{$lang.backup}" type="button" id="backup" />
									</p>
								</div>
                            </div>
                            {else}
                            <div class="form-group">
                             	<label class="col-sm-4 control-label"></label>
                             	<div class="col-sm-8">
                               		<p class="form-control-static">
                               			<input class="btn btn-primary" onclick="setupTemplate('{$template.code}')" value="使用该模板" type="button" />
                               		</p>
                               	</div>
                            </div>
                            {/if}
                        </form>
                    </div>
                </div>
            </div>
            {/foreach}
            
        </div>
    </div>
</body>
<script type="text/javascript">
function setupTemplate(tpl){
	swal({
		title : "是否更换模板？",
		text : "",
		type : "warning",
		showCancelButton : true,
		confirmButtonColor : "#DD6B55",
		confirmButtonText : "确定",
		cancelButtonText : "取消",
		closeOnConfirm : true,
		closeOnCancel : true
	}, function(isConfirm) {
		if (isConfirm) {
			$.get('template.php?is_ajax=1&act=install&tpl_name=' + tpl, function(data){
				if(data.error == 0){
					if (parent.gritter){
						parent.gritter({
							title : '操作提示',
							text : '操作成功',
							time : 10000
						});
					}
					
					location.reload();
				}else{
					gritter({
						title : '操作失败',
						text : data.message,
						time : 10000
					});
				}
			}, 'json');
		}
	});
	return false;
}

function backupTemplate(tpl){
	swal({
		title : "是否备份当前模板？",
		text : "",
		type : "warning",
		showCancelButton : true,
		confirmButtonColor : "#DD6B55",
		confirmButtonText : "确定",
		cancelButtonText : "取消",
		closeOnConfirm : true,
		closeOnCancel : true
	}, function(isConfirm) {
		if (isConfirm) {
			gritter({
				title : '操作提示',
				text : '正在操作，请勿离开!',
				time : 10000
			});
			$.get('template.php?is_ajax=1&act=backup&tpl_name=' + tpl, function(data){
				if(data.error == 0){
					if (parent.gritter){
						parent.gritter({
							title : '操作提示',
							text : '操作成功，请保存备份文件！',
							time : 10000
						});
					}
					location.href = data.content;
				}else{
					gritter({
						title : '操作失败',
						text : data.message,
						time : 10000
					});
				}
			}, 'json');
		}
	});
	return false;
}

</script>
</html>