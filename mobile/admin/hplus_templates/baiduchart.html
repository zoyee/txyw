<!DOCTYPE html>
<html>

{include file='head.htm'}


<link href="css/plugins/clockpicker/clockpicker.css" rel="stylesheet">

<link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">
<link href="css/plugins/colorpicker/css/bootstrap-colorpicker.min.css"
	rel="stylesheet">



<script src="js/echarts.min.js"></script>
<script src="js/china.js"></script>

<!--   <script src="js/plugins/echarts/echarts-all.js"></script>-->

<script src="js/plugins/colorpicker/bootstrap-colorpicker.min.js"></script>
<script src="js/plugins/clockpicker/clockpicker.js"></script>
<script src="js/plugins/switchery/switchery.js"></script>



<script src="js/plugins/datapicker/bootstrap-datepicker.js"></script>

</head>

<body class="gray-bg">

	<div class="wrapper wrapper-content animated fadeInUp">

		<div class="row">
			<div class="ibox">
				<div class="ibox-title">
					<h5>所有订单</h5>
				</div>
				<div class="ibox-content">
					<div class="row m-b-sm m-t-sm">



						<div class="form-group"
							style="margin-top: 3px; margin-bottom: 3px">
							<form action="flow_stats.php?act=getFlowStats" id="query_form">
								<label for="starttime" class="col-sm-1 control-label"
									style="margin-top: 5px; margin-bottom: 5px">查询时间段</label>
								<div class="col-md-6">
									<div class="form-group" id="data_5"
										style="float: left; text-align: center; vertical-align: middle">
										<div class="input-daterange input-group" id="datepicker"
											style="float: left">
											<input type="text" class="input-sm form-control"
												name="start_date" id="start_date" /> <span
												class="input-group-addon">到</span> <input type="text"
												class="input-sm form-control" name="end_date" id="end_date"
												value= />
										</div>

									</div>

								</div>
								<div class="col-md-6" >
								<button type="button" id="search" class="btn btn-sm btn-primary"
									onclick="getData()">
									<i class="fa fa-refresh"></i>&nbsp查询
								</button>
								</div>
							</form>
						</div>

					</div>

				</div>
			</div>

		
		<div class="col-sm-6">
			<div class="ibox">
				<div class="ibox-title">
					<h5>访问流量统计</h5>
				</div>
				<div class="ibox-content">
					<div class="row m-b-sm m-t-sm" style="margin-top: 10px;margin-bottom: 10px">

						<div class="flot-chart" id="flowChart-div" style="height: 400px">
						</div>


					</div>

				</div>
			</div>
		</div>
		
		<div class="col-sm-6">
			<div class="ibox">
				<div class="ibox-title">
					<h5>来源网站</h5>
				</div>
				<div class="ibox-content">
					<div class="row m-b-sm m-t-sm" style="margin-top: 10px;margin-bottom: 10px">

						<div class="pie-chart" id="sourceChart-div" style="height: 400px">
						</div>


					</div>

				</div>
			</div>
		</div>
		
		
		<div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>中国地图</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="dropdown-toggle" data-toggle="dropdown" href="graph_flot.html#">
                                <i class="fa fa-wrench"></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
                                <li><a href="graph_flot.html#">选项1</a>
                                </li>
                                <li><a href="graph_flot.html#">选项2</a>
                                </li>
                            </ul>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">
                        <div style="height:600px" id="echarts-map-chart"></div>
                    </div>
                </div>
            </div>
        </div>
		
		</div>

	</div>

	<script type="text/javascript">
		$("#data_5 .input-daterange").datepicker({
			keyboardNavigation : !1,
			forceParse : !1,
			autoclose : !0
		});

		$(document).ready(function() {

			var sdate = new Date();
			sdate.setDate(sdate.getDate() - 30);

			$('#start_date').datepicker({
				dateFormat : "yyyy-mm-dd"
			}).datepicker("setDate", sdate);
			$('#end_date').datepicker({
				dateFormat : "yyyy-mm-dd"
			}).datepicker("setDate", new Date());

			getData();
		});

		function getData() {

			$.get('flow_stats.php?act=getOrderStats&start_date='
					+ $('#start_date').val() + '&end_date='
					+ $('#end_date').val(), function(data) {
				setOrderChart(data);
			}, 'json');
			
			$.get('flow_stats.php?act=getFlowStats&start_date='
					+ $('#start_date').val() + '&end_date='
					+ $('#end_date').val(), function(data) {
				createFlowChart(data);
			}, 'json');

			
			$.get('flow_stats.php?act=getSourceStats&start_date='
					+ $('#start_date').val() + '&end_date='
					+ $('#end_date').val(), function(data) {
				createSourceChart(data);
			}, 'json');
			
			
			$.get('flow_stats.php?act=getRegionStats&start_date='
					+ $('#start_date').val() + '&end_date='
					+ $('#end_date').val(), function(data) {
				createRegionChart(data);
			}, 'json');
			
		}
		
		var myChart;
		var flowData;
		var pay_day = new Array();;
		var pay_count = new Array();
		
		
		function setOrderChart(data) {

			orderData = data;
			
			// 填入数据
			//data=eval('['+data+']')
			

			for ( var p in data.content) {
				pay_day[p] = data.content[p].pay_time;

			}
			
			
			for ( var p in data.content) {
				pay_count[p] = data.content[p].order_count;

			}
			
		}

		function createFlowChart(data) {

			myChart = echarts.init(document.getElementById('flowChart-div'));

			// 填入数据
			//data=eval('['+data+']')
			var access_date = new Array();

			for ( var p in data.content) {
				access_date[p] = data.content[p].access_time;

			}
			
			var access_count = new Array();
			for ( var p in data.content) {
				access_count[p] = data.content[p].access_count;

			}

			myChart.setOption({
				title : {
					text : '流量分析'
				},
				tooltip : {
					trigger : "axis"
				},
				grid : {
					x : 40,
					x2 : 40,
					y2 : 24
				},
				legend : {
					data : [ '销量','访问量' ]
				},
				xAxis : {
					data : access_date
				},
				yAxis : {},
				series : [ {
					name : '访问量',
					type : 'line',
					data : access_count,
					markPoint : {
						data : [ {
							type : "max",
							name : "最大访问量"
						}, {
							type : "min",
							name : "最小访问量"
						} ]
					},
					markLine : {
						data : [ {
							type : "average",
							name : "平均访问量"
						},  ]
					}
				} ,
				{
					name : '销量',
					type : 'line',
					smooth:true,
					stack: '总量',
					itemStyle: {normal: {areaStyle: {type: 'default'}}},
					data : pay_count,
					markPoint : {
						data : [ {
							type : "max",
							name : "最大订单量"
						}, {
							type : "min",
							name : "最小订单量"
						} ]
					}
				} ]
			});
			$(window).resize(myChart.resize);
		}
		
		
		//访问来源图
		function createSourceChart(data) {

			var myChart = echarts.init(document.getElementById('sourceChart-div'));

			// 填入数据
			//data=eval('['+data+']')
			var namelist = new Array();

			for ( var p in data.content) {
				namelist[p] = data.content[p].name;

			}

			myChart.setOption({
				 title: {
			            text: "青山老农微商城用户访问统计",
			            subtext: "统计元素-PV",
			            x: "center"
			        },
			        tooltip: {trigger: "item", formatter: "{a} <br/>{b} : {c} ({d}%)"},
			        legend: {orient: "vertical", x: "left", data: namelist},
			        calculable: !0,
			        series: [{
			            name: "访问来源",
			            type: "pie",
			            radius: "55%",
			            center: ["50%", "60%"],
			            data: data.content
			        }]
			});
			$(window).resize(myChart.resize);
		}
		
		
		//访问来源图
		function createRegionChart(data) {
			
			
			var avg;
			var k=0;
			var sum=0;
			for ( var p in data.content.money_paid) {
				sum = sum + parseFloat(data.content.money_paid[p].value);
				k++;

			}
			avg = sum/k*2;

			 var s = echarts.init(document.getElementById("echarts-map-chart")), c = {
			        title: {
			            text: "销量分布图",
			            subtext: "",
			            x: "center"
			        },
			        tooltip: {trigger: "item"},
			        legend: {orient: "vertical", x: "left", data: ["销售金额", "销售数量"]},
			        //dataRange: {min: 0, max: 2500, x: "left", y: "bottom", text: ["高", "低"], calculable: !0},
			        toolbox: {
			            show: !0,
			            orient: "vertical",
			            x: "right",
			            y: "center",
			            feature: {
			                mark: {show: !0},
			                dataView: {show: !0, readOnly: !1},
			                restore: {show: !0},
			                saveAsImage: {show: !0}
			            }
			        },
			        roamController: {show: !0, x: "right", mapTypeControl: {china: !0}},
			        dataRange: {
		                min: 0,
		                max : avg,
		                text:['高','低'],           // 文本，默认为数值文本
		                calculable : true,
		                x: 'left',
		                color: ['orangered','yellow','lightskyblue']
		            },
			        series: [{
			            name: "销售金额",
			            type: "map",
			            mapType: "china",
			            roam: !1,
			            itemStyle: {normal: {label: {show: !0}}, emphasis: {label: {show: !0}}},
			            data: data.content.money_paid
			        },{
			            name: "销售数量",
			            type: "map",
			            mapType: "china",
			            roam: !1,
			            itemStyle: {normal: {label: {show: !0}}, emphasis: {label: {show: !0}}},
			            data: data.content.order_num
			        }]
			    };
			    s.setOption(c), $(window).resize(s.resize);
		}
		
	</script>
</body>
</html>